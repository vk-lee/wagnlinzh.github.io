<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        前后端分离的思考与实践（二） by阿里 | wanglinzhizhi
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="wanglinzhizhi">
    <meta name="description" content="游走在上下文无关文法间">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="wanglinzhizhi">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.wanglinzhizhi.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="前后端分离的思考与实践（二） by阿里 | wanglinzhizhi">
    <meta property="og:description" content="游走在上下文无关文法间">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<link rel="stylesheet" href="/css/highlight/atom-one-dark.css">
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前后端分离的思考与实践（二）"><span class="post-toc-number">1.</span> <span class="post-toc-text">前后端分离的思考与实践（二）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TOC"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">TOC</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#本文"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">本文</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#浏览器端渲染的好处"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">浏览器端渲染的好处</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#浏览器端渲染造成的坏处"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">浏览器端渲染造成的坏处</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#反思前后端的定义"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">反思前后端的定义</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#淘宝中途岛-Midway"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">淘宝中途岛 Midway</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#职责划分"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">职责划分</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#模版共享"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">模版共享</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#路由共享"><span class="post-toc-number">1.10.</span> <span class="post-toc-text">路由共享</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#模版共享的实践"><span class="post-toc-number">1.11.</span> <span class="post-toc-text">模版共享的实践</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例探讨"><span class="post-toc-number">1.12.</span> <span class="post-toc-text">案例探讨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例一-复杂交互应用-（如购物车、下单页面）"><span class="post-toc-number">1.13.</span> <span class="post-toc-text">案例一 复杂交互应用 （如购物车、下单页面）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例二-单页面应用"><span class="post-toc-number">1.14.</span> <span class="post-toc-text">案例二 单页面应用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例三-纯浏览型页面"><span class="post-toc-number">1.15.</span> <span class="post-toc-text">案例三 纯浏览型页面</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例四-跨终端页面"><span class="post-toc-number">1.16.</span> <span class="post-toc-text">案例四 跨终端页面</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总结"><span class="post-toc-number">1.17.</span> <span class="post-toc-text">总结</span></a></li></ol></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            前后端分离的思考与实践（二） by阿里
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/me.jpeg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>wanglinzhizhi</strong>
        <span>Jan 21, 2017</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/前后端分离/">前后端分离</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/架构/">架构</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    <!-- Leancloud Views -->
    <a class="post_share-link" href="#">
        <li class="mdl-menu__item">
            <span id="/2017/01/21/前后端分离的思考与实践(2)/" class="leancloud-views_num" data-flag-title="前后端分离的思考与实践（二） by阿里">
     &nbsp;浏览量
</span>
        </li>
    </a>
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=前后端分离的思考与实践（二） by阿里&url=http://www.wanglinzhizhi.me//2017/01/21/前后端分离的思考与实践(2)/index.html&via=wanglinzhizhi" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://www.wanglinzhizhi.me//2017/01/21/前后端分离的思考与实践(2)/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=前后端分离的思考与实践（二） by阿里&url=http://www.wanglinzhizhi.me//2017/01/21/前后端分离的思考与实践(2)/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<h2 id="前后端分离的思考与实践（二）"><a href="#前后端分离的思考与实践（二）" class="headerlink" title="前后端分离的思考与实践（二）"></a>前后端分离的思考与实践（二）</h2><h3 id="TOC"><a href="#TOC" class="headerlink" title="TOC"></a>TOC</h3><p><strong>基于前后端分离的模版探索</strong></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在做前后端分离时，第一个关注到的问题就是 <strong>渲染</strong>，也就是 <strong>View</strong> 这个层面的工作。</p>
<p>在传统的开发模式中，浏览器端与服务器端是由不同的前后端两个团队开发，但是模版却又在这两者中间的模糊地带。因此模版上面总不可避免的越来越多复杂逻辑，最终难以维护。</p>
<p>而我们选择了NodeJS，作为一个前后端的中间层。试图藉由NodeJS，来疏理 <strong>View</strong> 层面的工作。</p>
<p>使得前后端分工更明确，让专案更好维护，达成更好的用户体验。</p>
<h3 id="本文"><a href="#本文" class="headerlink" title="本文"></a>本文</h3><p>渲染这块工作，对于前端开发者的日常工作来说，佔了非常大的比例，也是最容易与后端开发纠结不清的地方。</p>
<p>回首过去前端技术发展的这几年， <strong>View</strong> 这个层面的工作，经过了许多次的变革，像是：</p>
<ol>
<li>Form Submit 全页刷新 =&gt; <em>AJAX局部刷新</em></li>
<li>服务端续染 + MVC =&gt; <em>客户端渲染 + MVC</em></li>
<li>传统换页跳转 =&gt; 单页面应用</li>
</ol>
<p>可以观察到在这几年，大家都倾向将 <strong>渲染</strong> 这件事，从服务器端端移向了浏览器端。</p>
<p>而服务器端则专注于 <strong>服务化</strong> ，提供数据接口。</p>
<h3 id="浏览器端渲染的好处"><a href="#浏览器端渲染的好处" class="headerlink" title="浏览器端渲染的好处"></a>浏览器端渲染的好处</h3><p>浏览器端渲染的好处，我们都很清楚，像是</p>
<ol>
<li>摆脱业务逻辑与呈现逻辑在Java模版引擎中的耦合与混乱。</li>
<li>针对多终端应用，更容易以接口化的形式。在浏览器端搭配不同的模版，呈现不同的应用。</li>
<li>页面呈现本来就不仅是html，在前端的渲染可以更轻易的以组件化形式 (html + js + css)提供功能，使得前端组件不需依赖于服务端产生的html结构。</li>
<li>脱离对于后端开发、发佈流程的依赖。</li>
<li>方便联调。</li>
</ol>
<h3 id="浏览器端渲染造成的坏处"><a href="#浏览器端渲染造成的坏处" class="headerlink" title="浏览器端渲染造成的坏处"></a>浏览器端渲染造成的坏处</h3><p>但是在享受好处的同时，我们同样的也面临了 <strong>浏览器端渲染</strong> 所带来的坏处，像是：</p>
<ol>
<li>模版分离在不同的库。有的模版放在服务端 (JAVA)，而有的放在浏览器端 (JS)。前后端模版语言不相通。</li>
<li>需要等待所有模版与组件在浏览器端载入完成后才能开始渲染，无法即开即看。</li>
<li>首次进入会有白屏等待渲染的时间，不利于用户体验</li>
<li>开发单页面应用时，前端Route与服务器端Route不匹配，处理起来很麻烦。</li>
<li>重要内容都在前端组装，不利于SEO</li>
</ol>
<h3 id="反思前后端的定义"><a href="#反思前后端的定义" class="headerlink" title="反思前后端的定义"></a>反思前后端的定义</h3><p>其实回头想想，在我们把渲染的工作从 服务端(Java) 抽出来到 浏览器端(JS) 的时候，我们的目的只是 <strong>明确的前后端职责划分，并不是非浏览器渲染不可</strong> 。</p>
<p>只是因为在传统的开发模式中，出了服务器就到了浏览器，所以前端的工作内容只能被限制在浏览器端。</p>
<p>也因此很多人认定了 <code>后端 = 服务端</code> <code>前端 = 浏览器端</code> ，就像下面这张图。</p>
<p><img src="http://gtms04.alicdn.com/tps/i4/T1q1.bFvRcXXb1InQp-499-130.png" alt="img"></p>
<p>而在淘宝UED目前进行的 <strong>中途岛Midway</strong> 项目中，藉由在 JAVA - Browser中间搭建一个NodeJS中间层，试图把这个前后端的分割线，重新针对 <strong>工作职责</strong> 去区分，而非针对硬体环境去区分（服务器 &amp; 浏览器）。</p>
<p>因此我们有机会做到模版与路由的共享，也是一个前后端分工中最理想的状态。</p>
<hr>
<h3 id="淘宝中途岛-Midway"><a href="#淘宝中途岛-Midway" class="headerlink" title="淘宝中途岛 Midway"></a>淘宝中途岛 Midway</h3><p>在中途岛项目中，我们把前后端分界的那条线，从浏览器端移回到了服务器端。</p>
<p><img src="http://gtms02.alicdn.com/tps/i2/T1qGMbFyJcXXbhov2c-562-130.png" alt="img"></p>
<p>藉由一个由前端 <strong>轻松掌控</strong> 且 <strong>与浏览器共通</strong> 的Nodejs层，可以更清晰的完成了前后端分离。</p>
<p>也可以让前端开发针对不同的情况，自行决定 <strong>最适当的解决方案</strong> 。而不是所有事情 <strong>都在浏览器端来处理</strong> 。</p>
<h3 id="职责划分"><a href="#职责划分" class="headerlink" title="职责划分"></a>职责划分</h3><p>中途岛并不是前端试图抢后端饭碗的项目，目的只是把 <strong>模版</strong> 这个模糊地带切割清楚，取得更明确的职责划分。</p>
<ul>
<li>后端 (JAVA)，专注于<ol>
<li>服务层</li>
<li>数据格式、数据稳定</li>
<li>业务逻辑</li>
</ol>
</li>
<li>前端，专注于<ol>
<li>UI层</li>
<li>控制逻辑、渲染逻辑</li>
<li>交互、用户体验</li>
</ol>
</li>
</ul>
<p>而不再拘泥于服务端或浏览器端的差异。</p>
<h3 id="模版共享"><a href="#模版共享" class="headerlink" title="模版共享"></a>模版共享</h3><p>在传统的开发模式中，浏览器端与服务器端是由不同的前后端两个团队开发，但是模版却又在这两者中间的模糊地带。因此模版上面总不可避免的越来越多复杂逻辑，最终难以维护。</p>
<p>有了NodeJS，后端同学可以在JAVA层专注于业务逻辑与数据的开发。而前端同学则专注于控制逻辑与渲染的开发。并且自行选择这些模版是要在 <strong>服务端 (NodeJS)</strong> 或是 <strong>浏览器端</strong> 做渲染。</p>
<p>用著一样的模版语言 <em>XTemplate</em> ，一样的渲染引擎 <em>JavaScript</em></p>
<p>在 <strong>不同的渲染环境</strong> （Server-side、PC Browser、Mobile Browser、Web View、etc.） 渲染出 <strong>一样的结果</strong> 。</p>
<h3 id="路由共享"><a href="#路由共享" class="headerlink" title="路由共享"></a>路由共享</h3><p>也因为有了NodeJS这一层，可以更细致的控制路由。</p>
<p>假如需要在前端做浏览器端路由时，可以同时配置服务器端的路由，使其在 <strong>浏览器端换页</strong> 或是 <strong>服务端换页</strong> ，都可以得到一致的渲染效果。</p>
<p>同时也处理了SEO的问题。</p>
<hr>
<h3 id="模版共享的实践"><a href="#模版共享的实践" class="headerlink" title="模版共享的实践"></a>模版共享的实践</h3><p>通常我们在浏览器端渲染一份模版时，流程不外乎是</p>
<ol>
<li>在浏览器端載入模版引擎 （xtmpleate, juicer, handlerbar, etc.）</li>
<li>在浏览器端载入模版档案，方法可能有<ul>
<li>使用 `` 印在页面上</li>
<li>使用模块载入工具，载入模版档案 （KISSY, requireJS, etc.）</li>
<li>其他</li>
</ul>
</li>
<li>取得数据，使用模版引擎产生html</li>
<li>将html插入到指定位置。</li>
</ol>
<p>從以上的流程可以觀察到，要想要做到模版的跨端共享，重点其实在 <strong>一致的模块选型</strong> 这件事。</p>
<p>市面上流行很多种模块标准，例如 KMD、AMD、CommonJS，只要能将NodeJS的模版档案透过一致模块规范输出到NodeJS端，就可以做基本的模版共享了。</p>
<p>而后续的系列文章会针对Model的proxy与共享，做进一步的探讨。</p>
<hr>
<h3 id="案例探讨"><a href="#案例探讨" class="headerlink" title="案例探讨"></a>案例探讨</h3><p>因为有了中途岛这中间层，针对过往的一些问题都有了更好的解答，例如说</p>
<h3 id="案例一-复杂交互应用-（如购物车、下单页面）"><a href="#案例一-复杂交互应用-（如购物车、下单页面）" class="headerlink" title="案例一 复杂交互应用 （如购物车、下单页面）"></a>案例一 复杂交互应用 （如购物车、下单页面）</h3><ul>
<li>状况：全部的HTML都是在前端渲染完成，服务端仅提供接口。</li>
<li>问题：进入页面时，会有短暂白屏。</li>
<li>解答：<ol>
<li>首次进入页面，在NodeJS端进行 <strong>全页渲染</strong> ，并在背景下载相关的模版。</li>
<li>后续交互操作，在浏览器端完成 <strong>局部刷新</strong></li>
<li>用的是 <strong>同一份模版</strong> ， 产生 <strong>一样的结果</strong></li>
</ol>
</li>
</ul>
<h3 id="案例二-单页面应用"><a href="#案例二-单页面应用" class="headerlink" title="案例二 单页面应用"></a>案例二 单页面应用</h3><ul>
<li>状况：使用Client Side MVC框架，在浏览器换页。</li>
<li>问题：渲染与换页都在浏览器端完成，直接输入网址进入或f5刷新时，无法直接呈现同样的内容。</li>
<li>解答：<ol>
<li>在浏览器端与NodeJS端共享 <strong>同样的Route</strong> 设定</li>
<li>浏览器端换页时，在浏览器端进行Route变更与 <strong>页面内容渲染</strong></li>
<li>直接输入同样的网址时，在NodeJS端进行 <strong>页面框架 + 页面内容渲染</strong></li>
<li>不管是浏览器端换页，或直接输入同样的网址，看到的内容都是 <strong>一样的</strong> 。</li>
<li>除了增加体验、减少逻辑複杂度外。更解决了 <strong>SEO</strong> 的问题</li>
</ol>
</li>
</ul>
<h3 id="案例三-纯浏览型页面"><a href="#案例三-纯浏览型页面" class="headerlink" title="案例三 纯浏览型页面"></a>案例三 纯浏览型页面</h3><ul>
<li>状况：页面仅提供资讯，较少或没有交互</li>
<li>问题：html在服务端产生，css与js放在另外一个位置，彼此间有依赖。</li>
<li>解答：<ol>
<li>透过NodeJS，统一管理html + css + js</li>
<li>日后若需要扩展成复杂应用或是单页面应用，也可以轻易转移。</li>
</ol>
</li>
</ul>
<h3 id="案例四-跨终端页面"><a href="#案例四-跨终端页面" class="headerlink" title="案例四 跨终端页面"></a>案例四 跨终端页面</h3><ul>
<li>状况：同样的应用要在不同端点呈现不同的介面与交互</li>
<li>问题：html管理不易，常常会在服务端产生不一样的html，浏览器端又要做不一样的处理</li>
<li>解答：<ol>
<li>跨终端的页面是渲染的问题，统一由前端来处理。</li>
<li>透过NodeJS层与后端服务化，可以针对这类型复杂应用，设计最佳的解决方案。</li>
</ol>
</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>过去的AJAX、Client-side MVC、SPA、Two-way Data Binding 等技术的出现，都是试图要解决当时的前端开发遇到的瓶颈。</p>
<p>而NodeJS中间层的出现，也是在试图解决现今前端被侷限在浏览器端的一个限制。</p>
<p>这边文章专注于前后端模版共享，也希望能抛砖引玉，与大家一起讨论如何在NodeJS中间层这个架构下，我们可以怎样的改善我们的工作流程，怎样的跟 <strong>后端</strong>配合，来把 <strong>前端</strong> 这个工作做得更好。\</p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                
                    


                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2017/01/21/前后端分离的思考与实践(1)/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/01/21/前后端分离的思考与实践(3)/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/me.jpeg" alt="wanglinzhizhi's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        wanglinzhizhi@hotmail.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="#" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">72</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	
		<li>
			<a href="/tags" title="Tags">
				Tags
			</a>
		</li>
	
		<li>
			<a href="/gallery" title="Gallery">
				Gallery
			</a>
		</li>
	
		<li>
			<a href="/about" title="About">
				About
			</a>
		</li>
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">72</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    
    
    <!-- Facebook -->
    
    
    
    <!-- Google + -->
    
    
    
    <!-- Weibo -->
    
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/wagnlinzh" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;wanglinzhizhi</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>


	<script src="/js/smoothscroll.js"></script>



    <!-- Leancloud -->
	<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
	<script>
		AV.initialize("EObBAbqpQfNFLuV5SjbVgoxq-gzGzoHsz", "qPdmjfSU3DDmPPH9ui0cUW4z");
	</script>
    <script>
	function showTime(Counter) {
		var query = new AV.Query(Counter);
		$(".leancloud-views_num").each(function() {
			var url = $(this).attr("id").trim();
			query.equalTo("url", url);
			query.find({
				success: function(results) {
					if (results.length == 0) {
						var content = '0 ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
						return;
					}
					for (var i = 0; i < results.length; i++) {
						var object = results[i];
						var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
					}
				},
				error: function(object, error) {
					console.log("Error: " + error.code + " " + error.message);
				}
			});

		});
	}

	function addCount(Counter) {
		var Counter = AV.Object.extend("Counter");
		url = $(".leancloud-views_num").attr('id').trim();
		title = $(".leancloud-views_num").attr('data-flag-title').trim();
		var query = new AV.Query(Counter);
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length > 0) {
					var counter = results[0];
					counter.fetchWhenSave(true);
					counter.increment("time");
					counter.save(null, {
						success: function(counter) {
							var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(counter, error) {
							console.log('Failed to save Visitor num, with error message: ' + error.message);
						}
					});
				} else {
					var newcounter = new Counter();
					newcounter.set("title", title);
					newcounter.set("url", url);
					newcounter.set("time", 1);
					newcounter.save(null, {
						success: function(newcounter) {
							console.log("newcounter.get('time')="+newcounter.get('time'));
							var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(newcounter, error) {
							console.log('Failed to create');
						}
					});
				}
			},
			error: function(error) {
				console.log('Error:' + error.code + " " + error.message);
			}
		});
	}
	$(function() {
		var Counter = AV.Object.extend("Counter");
		if ($('.leancloud-views_num').length == 1) {
			addCount(Counter);
		} else if ($('.post-title-link').length > 1) {
			showTime(Counter);
		}
	}); 
</script>








<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
        var inputArea = document.querySelector("#search");
        var getSearchFile = function(){
            var path = "search.xml";
            searchFunc(path, 'search', 'local-search-result');
        }

        inputArea.onfocus = function(){ getSearchFile() }
	</script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>
		
    </body>
		
	
</html>
